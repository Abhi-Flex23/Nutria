import{a as n}from"./chunk.I4CX4JT3.js";var s=new WeakMap,l=new WeakMap,a=new WeakMap,h=class{constructor(e,o){(this.host=e).addController(this),this.options=n({form:t=>{if(t.hasAttribute("form")&&t.getAttribute("form")!==""){let i=t.getRootNode(),r=t.getAttribute("form");if(r)return i.getElementById(r)}return t.closest("form")},name:t=>t.name,value:t=>t.value,defaultValue:t=>t.defaultValue,disabled:t=>{var i;return(i=t.disabled)!=null?i:!1},reportValidity:t=>typeof t.reportValidity=="function"?t.reportValidity():!0,setValue:(t,i)=>t.value=i},o),this.handleFormData=this.handleFormData.bind(this),this.handleFormSubmit=this.handleFormSubmit.bind(this),this.handleFormReset=this.handleFormReset.bind(this),this.reportFormValidity=this.reportFormValidity.bind(this),this.handleUserInput=this.handleUserInput.bind(this)}hostConnected(){let e=this.options.form(this.host);e&&this.attachForm(e),this.host.addEventListener("sl-input",this.handleUserInput)}hostDisconnected(){this.detachForm(),this.host.removeEventListener("sl-input",this.handleUserInput)}hostUpdated(){let e=this.options.form(this.host);e||this.detachForm(),e&&this.form!==e&&(this.detachForm(),this.attachForm(e)),this.host.hasUpdated&&this.setValidity(this.host.checkValidity())}attachForm(e){e?(this.form=e,s.has(this.form)?s.get(this.form).add(this.host):s.set(this.form,new Set([this.host])),this.form.addEventListener("formdata",this.handleFormData),this.form.addEventListener("submit",this.handleFormSubmit),this.form.addEventListener("reset",this.handleFormReset),a.has(this.form)||(a.set(this.form,this.form.reportValidity),this.form.reportValidity=()=>this.reportFormValidity())):this.form=void 0}detachForm(){var e;this.form&&((e=s.get(this.form))==null||e.delete(this.host),this.form.removeEventListener("formdata",this.handleFormData),this.form.removeEventListener("submit",this.handleFormSubmit),this.form.removeEventListener("reset",this.handleFormReset),a.has(this.form)&&(this.form.reportValidity=a.get(this.form),a.delete(this.form))),this.form=void 0}handleFormData(e){let o=this.options.disabled(this.host),t=this.options.name(this.host),i=this.options.value(this.host),r=this.host.tagName.toLowerCase()==="sl-button";!o&&!r&&typeof t=="string"&&t.length>0&&typeof i!="undefined"&&(Array.isArray(i)?i.forEach(m=>{e.formData.append(t,m.toString())}):e.formData.append(t,i.toString()))}handleFormSubmit(e){var i;let o=this.options.disabled(this.host),t=this.options.reportValidity;this.form&&!this.form.noValidate&&((i=s.get(this.form))==null||i.forEach(r=>{this.setUserInteracted(r,!0)})),this.form&&!this.form.noValidate&&!o&&!t(this.host)&&(e.preventDefault(),e.stopImmediatePropagation())}handleFormReset(){this.options.setValue(this.host,this.options.defaultValue(this.host)),this.setUserInteracted(this.host,!1)}async handleUserInput(){await this.host.updateComplete,this.setUserInteracted(this.host,!0)}reportFormValidity(){if(this.form&&!this.form.noValidate){let e=this.form.querySelectorAll("*");for(let o of e)if(typeof o.reportValidity=="function"&&!o.reportValidity())return!1}return!0}setUserInteracted(e,o){l.set(e,o),e.requestUpdate()}doAction(e,o){if(this.form){let t=document.createElement("button");t.type=e,t.style.position="absolute",t.style.width="0",t.style.height="0",t.style.clipPath="inset(50%)",t.style.overflow="hidden",t.style.whiteSpace="nowrap",o&&(t.name=o.name,t.value=o.value,["formaction","formenctype","formmethod","formnovalidate","formtarget"].forEach(i=>{o.hasAttribute(i)&&t.setAttribute(i,o.getAttribute(i))})),this.form.append(t),t.click(),t.remove()}}reset(e){this.doAction("reset",e)}submit(e){this.doAction("submit",e)}setValidity(e){var r;let o=this.host,t=Boolean(l.get(o)),i=Boolean(o.required);(r=this.form)!=null&&r.noValidate?(o.removeAttribute("data-required"),o.removeAttribute("data-optional"),o.removeAttribute("data-invalid"),o.removeAttribute("data-valid"),o.removeAttribute("data-user-invalid"),o.removeAttribute("data-user-valid")):(o.toggleAttribute("data-required",i),o.toggleAttribute("data-optional",!i),o.toggleAttribute("data-invalid",!e),o.toggleAttribute("data-valid",e),o.toggleAttribute("data-user-invalid",!e&&t),o.toggleAttribute("data-user-valid",e&&t))}updateValidity(){let e=this.host;this.setValidity(e.checkValidity())}};export{s as a,h as b};
