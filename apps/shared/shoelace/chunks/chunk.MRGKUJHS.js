import{a as x}from"./chunk.BB5TGRH4.js";import{a as d}from"./chunk.Q7PZ4GVY.js";import{a as S}from"./chunk.Z35U7IGS.js";import{c as y}from"./chunk.MJKKE2MR.js";import{a as T}from"./chunk.DBCWAMJH.js";import{a as I,b as g,d as h,f as b}from"./chunk.N2CXUFX7.js";import{c as p}from"./chunk.I36YJ673.js";import{g as a}from"./chunk.OAQCUA7X.js";function A(m){function u(t){let s=t.parentElement;if(d.isTreeItem(s)){let l=s.getChildrenItems({includeDisabled:!1}),n=!!l.length&&l.every(o=>o.selected),i=l.every(o=>!o.selected&&!o.indeterminate);s.selected=n,s.indeterminate=!n&&!i,u(s)}}function e(t){for(let s of t.getChildrenItems())s.selected=!s.disabled&&t.selected,e(s)}u(m),e(m)}var r=class extends b{constructor(){super(...arguments);this.selection="single";this.localize=new y(this);this.initTreeItem=e=>{e.selectable=this.selection==="multiple",["expand","collapse"].filter(t=>!!this.querySelector(`[slot="${t}-icon"]`)).forEach(t=>{let s=e.querySelector(`[slot="${t}-icon"]`);s===null?e.append(this.getExpandButtonIcon(t)):s.hasAttribute("data-default")&&s.replaceWith(this.getExpandButtonIcon(t))})};this.handleTreeChanged=e=>{for(let t of e){let s=[...t.addedNodes].filter(d.isTreeItem),l=[...t.removedNodes].filter(d.isTreeItem);s.forEach(this.initTreeItem),l.includes(this.lastFocusedItem)&&this.focusItem(this.getFocusableItems()[0])}};this.handleFocusOut=e=>{let t=e.relatedTarget;(!t||!this.contains(t))&&(this.tabIndex=0)};this.handleFocusIn=e=>{let t=e.target;e.target===this&&this.focusItem(this.lastFocusedItem||this.getAllTreeItems()[0]),d.isTreeItem(t)&&!t.disabled&&(this.lastFocusedItem&&(this.lastFocusedItem.tabIndex=-1),this.lastFocusedItem=t,this.tabIndex=-1,t.tabIndex=0)}}async connectedCallback(){super.connectedCallback(),this.setAttribute("role","tree"),this.setAttribute("tabindex","0"),this.addEventListener("focusin",this.handleFocusIn),this.addEventListener("focusout",this.handleFocusOut),this.addEventListener("sl-lazy-change",this.handleSlotChange),await this.updateComplete,this.mutationObserver=new MutationObserver(this.handleTreeChanged),this.mutationObserver.observe(this,{childList:!0,subtree:!0})}disconnectedCallback(){super.disconnectedCallback(),this.mutationObserver.disconnect(),this.removeEventListener("focusin",this.handleFocusIn),this.removeEventListener("focusout",this.handleFocusOut),this.removeEventListener("sl-lazy-change",this.handleSlotChange)}getExpandButtonIcon(e){let s=(e==="expand"?this.expandedIconSlot:this.collapsedIconSlot).assignedElements({flatten:!0})[0];if(s){let l=s.cloneNode(!0);return[l,...l.querySelectorAll("[id]")].forEach(n=>n.removeAttribute("id")),l.setAttribute("data-default",""),l.slot=`${e}-icon`,l}return null}handleSelectionChange(){let e=this.getAllTreeItems();this.setAttribute("aria-multiselectable",this.selection==="multiple"?"true":"false");for(let t of e)t.selectable=this.selection==="multiple"}syncTreeItems(e){let t=this.getAllTreeItems();if(this.selection==="multiple")A(e);else for(let s of t)s!==e&&(s.selected=!1)}selectItem(e){let t=[...this.selectedItems];this.selection==="multiple"?(e.selected=!e.selected,e.lazy&&(e.expanded=!0),this.syncTreeItems(e)):this.selection==="single"||e.isLeaf?(e.expanded=!e.expanded,e.selected=!0,this.syncTreeItems(e)):this.selection==="leaf"&&(e.expanded=!e.expanded);let s=this.selectedItems;(t.length!==s.length||s.some(l=>!t.includes(l)))&&this.emit("sl-selection-change",{detail:{selection:s}})}get selectedItems(){let e=this.getAllTreeItems(),t=s=>s.selected;return e.filter(t)}getAllTreeItems(){return[...this.querySelectorAll("sl-tree-item")]}getFocusableItems(){let e=this.getAllTreeItems(),t=new Set;return e.filter(s=>{var n;if(s.disabled)return!1;let l=(n=s.parentElement)==null?void 0:n.closest("[role=treeitem]");return l&&(!l.expanded||l.loading||t.has(l))&&t.add(s),!t.has(s)})}focusItem(e){e==null||e.focus()}handleKeyDown(e){if(!["ArrowDown","ArrowUp","ArrowRight","ArrowLeft","Home","End","Enter"," "].includes(e.key))return;let t=this.getFocusableItems(),s=this.localize.dir()==="ltr",l=this.localize.dir()==="rtl";if(t.length>0){e.preventDefault();let n=t.findIndex(c=>c.matches(":focus")),i=t[n],o=c=>{let E=t[S(c,0,t.length-1)];this.focusItem(E)},f=c=>{i.expanded=c};e.key==="ArrowDown"?o(n+1):e.key==="ArrowUp"?o(n-1):s&&e.key==="ArrowRight"||l&&e.key==="ArrowLeft"?!i||i.disabled||i.expanded||i.isLeaf&&!i.lazy?o(n+1):f(!0):s&&e.key==="ArrowLeft"||l&&e.key==="ArrowRight"?!i||i.disabled||i.isLeaf||!i.expanded?o(n-1):f(!1):e.key==="Home"?o(0):e.key==="End"?o(t.length-1):(e.key==="Enter"||e.key===" ")&&(i.disabled||this.selectItem(i))}}handleClick(e){let s=e.target.closest("sl-tree-item"),l=e.composedPath().some(n=>{var i;return(i=n==null?void 0:n.classList)==null?void 0:i.contains("tree-item__expand-button")});!s||s.disabled||(this.selection==="multiple"&&l?s.expanded=!s.expanded:this.selectItem(s))}handleSlotChange(){this.getAllTreeItems().forEach(this.initTreeItem)}render(){return p`
      <div part="base" class="tree" @click=${this.handleClick} @keydown=${this.handleKeyDown}>
        <slot @slotchange=${this.handleSlotChange}></slot>
        <slot name="expand-icon" hidden aria-hidden="true"> </slot>
        <slot name="collapse-icon" hidden aria-hidden="true"> </slot>
      </div>
    `}};r.styles=x,a([h("slot:not([name])")],r.prototype,"defaultSlot",2),a([h("slot[name=expand-icon]")],r.prototype,"expandedIconSlot",2),a([h("slot[name=collapse-icon]")],r.prototype,"collapsedIconSlot",2),a([g()],r.prototype,"selection",2),a([T("selection")],r.prototype,"handleSelectionChange",1),r=a([I("sl-tree")],r);export{r as a};
