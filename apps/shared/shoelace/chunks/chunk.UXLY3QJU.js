import{a as T}from"./chunk.RDYD527W.js";import{a as d}from"./chunk.GOIJYA6S.js";import{a as S}from"./chunk.Z35U7IGS.js";import{c as x}from"./chunk.ISLNSUAB.js";import{a as E}from"./chunk.DBCWAMJH.js";import{a as g}from"./chunk.JUX3LFDW.js";import{a as I,b,d as m,f as y}from"./chunk.X7Q42RGY.js";import{c as p}from"./chunk.3G4FHXSN.js";import{g as a}from"./chunk.OAQCUA7X.js";function v(h){function u(t){let s=t.parentElement;if(d(s)){let l=s.getChildrenItems({includeDisabled:!1}),n=!!l.length&&l.every(o=>o.selected),i=l.every(o=>!o.selected&&!o.indeterminate);s.selected=n,s.indeterminate=!n&&!i,u(s)}}function e(t){for(let s of t.getChildrenItems())s.selected=!s.disabled&&t.selected,e(s)}u(h),e(h)}var r=class extends y{constructor(){super(...arguments);this.selection="single";this.treeItems=[];this.localize=new x(this);this.initTreeItem=e=>{e.selectable=this.selection==="multiple",["expand","collapse"].filter(t=>!!this.querySelector(`[slot="${t}-icon"]`)).forEach(t=>{let s=e.querySelector(`[slot="${t}-icon"]`);s===null?e.append(this.getExpandButtonIcon(t)):s.hasAttribute("data-default")&&s.replaceWith(this.getExpandButtonIcon(t))})};this.handleTreeChanged=e=>{for(let t of e){let s=[...t.addedNodes].filter(d),l=[...t.removedNodes].filter(d);s.forEach(this.initTreeItem),l.includes(this.lastFocusedItem)&&this.focusItem(this.getFocusableItems()[0])}};this.handleFocusOut=e=>{let t=e.relatedTarget;(!t||!this.contains(t))&&(this.tabIndex=0)};this.handleFocusIn=e=>{let t=e.target;e.target===this&&this.focusItem(this.lastFocusedItem||this.treeItems[0]),d(t)&&!t.disabled&&(this.lastFocusedItem&&(this.lastFocusedItem.tabIndex=-1),this.lastFocusedItem=t,this.tabIndex=-1,t.tabIndex=0)}}async connectedCallback(){super.connectedCallback(),this.setAttribute("role","tree"),this.setAttribute("tabindex","0"),this.addEventListener("focusin",this.handleFocusIn),this.addEventListener("focusout",this.handleFocusOut),this.addEventListener("sl-lazy-change",this.updateItems),await this.updateComplete,this.mutationObserver=new MutationObserver(this.handleTreeChanged),this.mutationObserver.observe(this,{childList:!0,subtree:!0})}disconnectedCallback(){super.disconnectedCallback(),this.mutationObserver.disconnect(),this.removeEventListener("focusin",this.handleFocusIn),this.removeEventListener("focusout",this.handleFocusOut),this.removeEventListener("sl-lazy-change",this.updateItems)}getExpandButtonIcon(e){let s=(e==="expand"?this.expandedIconSlot:this.collapsedIconSlot).assignedElements({flatten:!0})[0];if(s){let l=s.cloneNode(!0);return[l,...l.querySelectorAll("[id]")].forEach(n=>n.removeAttribute("id")),l.setAttribute("data-default",""),l.slot=`${e}-icon`,l}return null}handleSelectionChange(){this.setAttribute("aria-multiselectable",this.selection==="multiple"?"true":"false");for(let e of this.treeItems)e.selectable=this.selection==="multiple"}syncTreeItems(e){if(this.selection==="multiple")v(e);else for(let t of this.treeItems)t!==e&&(t.selected=!1)}selectItem(e){this.selection==="multiple"?(e.selected=!e.selected,e.lazy&&(e.expanded=!0),this.syncTreeItems(e)):this.selection==="single"||e.isLeaf?(e.expanded=!e.expanded,e.selected=!0,this.syncTreeItems(e)):this.selection==="leaf"&&(e.expanded=!e.expanded),g(this,"sl-selection-change",{detail:{selection:this.selectedItems}})}get selectedItems(){let e=[...this.treeItems],t=s=>s.selected;return e.filter(t)}getFocusableItems(){let e=new Set;return[...this.treeItems].filter(t=>{var l;if(t.disabled)return!1;let s=(l=t.parentElement)==null?void 0:l.closest("[role=treeitem]");return s&&(!s.expanded||s.loading||e.has(s))&&e.add(t),!e.has(t)})}focusItem(e){e==null||e.focus()}handleKeyDown(e){if(!["ArrowDown","ArrowUp","ArrowRight","ArrowLeft","Home","End","Enter"," "].includes(e.key))return;let t=this.getFocusableItems(),s=this.localize.dir()==="ltr",l=this.localize.dir()==="rtl";if(t.length>0){e.preventDefault();let n=t.findIndex(c=>c.matches(":focus")),i=t[n],o=c=>{let L=t[S(c,0,t.length-1)];this.focusItem(L)},f=c=>{i.expanded=c};e.key==="ArrowDown"?o(n+1):e.key==="ArrowUp"?o(n-1):s&&e.key==="ArrowRight"||l&&e.key==="ArrowLeft"?!i||i.disabled||i.expanded||i.isLeaf&&!i.lazy?o(n+1):f(!0):s&&e.key==="ArrowLeft"||l&&e.key==="ArrowRight"?!i||i.disabled||i.isLeaf||!i.expanded?o(n-1):f(!1):e.key==="Home"?o(0):e.key==="End"?o(t.length-1):(e.key==="Enter"||e.key===" ")&&(i.disabled||this.selectItem(i))}}handleClick(e){let s=e.target.closest("sl-tree-item"),l=e.composedPath().some(n=>{var i;return(i=n==null?void 0:n.classList)==null?void 0:i.contains("tree-item__expand-button")});!s||s.disabled||(this.selection==="multiple"&&l?s.expanded=!s.expanded:this.selectItem(s))}updateItems(){console.log("update"),this.treeItems=[...this.querySelectorAll("sl-tree-item")],[...this.treeItems].forEach(this.initTreeItem)}render(){return p`
      <div part="base" class="tree" @click=${this.handleClick} @keydown=${this.handleKeyDown}>
        <slot @slotchange=${this.updateItems}></slot>
        <slot name="expand-icon" hidden aria-hidden="true"> </slot>
        <slot name="collapse-icon" hidden aria-hidden="true"> </slot>
      </div>
    `}};r.styles=T,a([m("slot:not([name])")],r.prototype,"defaultSlot",2),a([m("slot[name=expand-icon]")],r.prototype,"expandedIconSlot",2),a([m("slot[name=collapse-icon]")],r.prototype,"collapsedIconSlot",2),a([b()],r.prototype,"selection",2),a([E("selection")],r.prototype,"handleSelectionChange",1),r=a([I("sl-tree")],r);export{r as a};
